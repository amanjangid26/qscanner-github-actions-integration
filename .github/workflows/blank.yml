name: Container Security Scan with Qualys

on:
  workflow_dispatch:
    inputs:
      image:
        description: 'Docker image to scan'
        required: true
        default: 'tomcat:10.0.0-M6-jdk11-corretto'
        type: string
      
      policy_tags:
        description: 'Qualys policy tags (comma-separated)'
        required: true
        default: '2026_forrester_image_policy'
        type: string
      
      push_on_success:
        description: 'Push image to registry if scan passes?'
        required: true
        type: boolean
        default: false
      
      target_registry:
        description: 'Target registry for push'
        required: false
        type: choice
        options:
          - docker.io
          - ghcr.io
          - both
        default: 'docker.io'
      
      target_repository:
        description: 'Target repository (e.g., myorg/myapp)'
        required: false
        type: string
        default: ''
      
      critical_threshold:
        description: 'Maximum critical vulnerabilities allowed'
        required: true
        type: number
        default: 0
      
      high_threshold:
        description: 'Maximum high vulnerabilities allowed'
        required: true
        type: number
        default: 5

env:
  QSCANNER_VERSION: v4.5.0

jobs:
  security-scan:
    name: ðŸ” Qualys Security Scan
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
      security-events: write
      packages: write
    
    outputs:
      scan_passed: ${{ steps.threshold_check.outputs.passed }}
      critical_count: ${{ steps.parse_results.outputs.critical }}
      high_count: ${{ steps.parse_results.outputs.high }}
      medium_count: ${{ steps.parse_results.outputs.medium }}
      total_count: ${{ steps.parse_results.outputs.total }}
    
    steps:
      - name: ðŸ“‹ Job Information
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘       Qualys Container Security Scan Started         â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ðŸ³ Image to scan: ${{ inputs.image }}"
          echo "ðŸ·ï¸  Policy tags: ${{ inputs.policy_tags }}"
          echo "ðŸ“Š Critical threshold: ${{ inputs.critical_threshold }}"
          echo "ðŸ“Š High threshold: ${{ inputs.high_threshold }}"
          echo "ðŸš€ Push on success: ${{ inputs.push_on_success }}"
          echo "ðŸ“¦ Target registry: ${{ inputs.target_registry }}"
          echo "ðŸ‘¤ Triggered by: ${{ github.actor }}"
          echo ""
      
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: ðŸ“¥ Pull Docker image
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“¥ STEP 1: Pulling Docker Image"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Image: ${{ inputs.image }}"
          docker pull ${{ inputs.image }}
          echo ""
          echo "âœ… Image pulled successfully"
          docker images | grep -E "REPOSITORY|$(echo ${{ inputs.image }} | cut -d':' -f1)" || docker images
      
      - name: â¬‡ï¸ Download Qualys Scanner
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "â¬‡ï¸  STEP 2: Downloading Qualys Scanner"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Version: ${{ env.QSCANNER_VERSION }}"
          curl -L "https://www.qualys.com/qscanner/download/${{ env.QSCANNER_VERSION }}/download_qscanner.sh" -o download_qscanner.sh
          chmod +x download_qscanner.sh
          bash ./download_qscanner.sh
          chmod +x ./linux-amd64/qscanner
          echo ""
          echo "âœ… Scanner downloaded successfully"
          ./linux-amd64/qscanner version
      
      - name: ðŸ” Run Qualys Security Scan
        id: qualys_scan
        continue-on-error: true
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ” STEP 3: Running Security Scan"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Scan started at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo ""
          
          ./linux-amd64/qscanner image ${{ inputs.image }} \
            --mode evaluate-policy \
            --report-format json \
            --pod ${{ secrets.QUALYS_POD }} \
            --access-token ${{ secrets.QUALYS_ACCESS_TOKEN }} \
            --tags "${{ inputs.policy_tags }}" \
            --output-file qualys-report.json \
            && echo "SCAN_STATUS=passed" >> $GITHUB_OUTPUT \
            || echo "SCAN_STATUS=failed" >> $GITHUB_OUTPUT
          
          echo ""
          echo "Scan completed at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          
          if [ "${{ steps.qualys_scan.outputs.SCAN_STATUS }}" == "passed" ]; then
            echo "âœ… Scan completed successfully"
          else
            echo "âš ï¸  Scan completed with policy violations"
          fi
      
      - name: ðŸ“Š Parse Scan Results
        id: parse_results
        if: always()
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“Š STEP 4: Analyzing Results"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          
          if [ -f "qualys-report.json" ]; then
            # Extract vulnerability counts (adjust based on actual Qualys JSON structure)
            CRITICAL=$(jq -r '.vulnerabilities | map(select(.severity == "CRITICAL" or .severity == "5")) | length' qualys-report.json 2>/dev/null || echo "0")
            HIGH=$(jq -r '.vulnerabilities | map(select(.severity == "HIGH" or .severity == "4")) | length' qualys-report.json 2>/dev/null || echo "0")
            MEDIUM=$(jq -r '.vulnerabilities | map(select(.severity == "MEDIUM" or .severity == "3")) | length' qualys-report.json 2>/dev/null || echo "0")
            LOW=$(jq -r '.vulnerabilities | map(select(.severity == "LOW" or .severity == "2")) | length' qualys-report.json 2>/dev/null || echo "0")
            TOTAL=$(jq -r '.vulnerabilities | length' qualys-report.json 2>/dev/null || echo "0")
            
            echo "critical=${CRITICAL}" >> $GITHUB_OUTPUT
            echo "high=${HIGH}" >> $GITHUB_OUTPUT
            echo "medium=${MEDIUM}" >> $GITHUB_OUTPUT
            echo "low=${LOW}" >> $GITHUB_OUTPUT
            echo "total=${TOTAL}" >> $GITHUB_OUTPUT
            
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘     Vulnerability Summary              â•‘"
            echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
            echo "â•‘  ðŸ”´ Critical:      $(printf '%4s' ${CRITICAL})                 â•‘"
            echo "â•‘  ðŸŸ  High:          $(printf '%4s' ${HIGH})                 â•‘"
            echo "â•‘  ðŸŸ¡ Medium:        $(printf '%4s' ${MEDIUM})                 â•‘"
            echo "â•‘  ðŸŸ¢ Low:           $(printf '%4s' ${LOW})                 â•‘"
            echo "â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â•‘"
            echo "â•‘  ðŸ“Š Total:         $(printf '%4s' ${TOTAL})                 â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          else
            echo "âš ï¸  Warning: Scan report not found"
            echo "critical=0" >> $GITHUB_OUTPUT
            echo "high=0" >> $GITHUB_OUTPUT
            echo "medium=0" >> $GITHUB_OUTPUT
            echo "low=0" >> $GITHUB_OUTPUT
            echo "total=0" >> $GITHUB_OUTPUT
          fi
      
      - name: ðŸŽ¯ Check Vulnerability Thresholds
        id: threshold_check
        if: always()
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸŽ¯ STEP 5: Threshold Validation"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          
          CRITICAL=${{ steps.parse_results.outputs.critical }}
          HIGH=${{ steps.parse_results.outputs.high }}
          CRITICAL_LIMIT=${{ inputs.critical_threshold }}
          HIGH_LIMIT=${{ inputs.high_threshold }}
          
          echo "Configured Thresholds:"
          echo "  Critical: ${CRITICAL_LIMIT}"
          echo "  High: ${HIGH_LIMIT}"
          echo ""
          echo "Found Vulnerabilities:"
          echo "  Critical: ${CRITICAL}"
          echo "  High: ${HIGH}"
          echo ""
          
          THRESHOLD_PASSED=true
          
          if [ "${CRITICAL}" -gt "${CRITICAL_LIMIT}" ]; then
            echo "âŒ FAILED: Critical vulnerabilities (${CRITICAL}) exceed threshold (${CRITICAL_LIMIT})"
            THRESHOLD_PASSED=false
          else
            echo "âœ… PASSED: Critical vulnerabilities within threshold"
          fi
          
          if [ "${HIGH}" -gt "${HIGH_LIMIT}" ]; then
            echo "âŒ FAILED: High vulnerabilities (${HIGH}) exceed threshold (${HIGH_LIMIT})"
            THRESHOLD_PASSED=false
          else
            echo "âœ… PASSED: High vulnerabilities within threshold"
          fi
          
          echo "passed=${THRESHOLD_PASSED}" >> $GITHUB_OUTPUT
          
          if [ "${THRESHOLD_PASSED}" != "true" ]; then
            echo ""
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘  âš ï¸  THRESHOLD CHECK FAILED            â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            exit 1
          else
            echo ""
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘  âœ… THRESHOLD CHECK PASSED             â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          fi
      
      - name: ðŸ“„ Upload Scan Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: qualys-scan-report-${{ github.run_number }}
          path: |
            qualys-report.json
            *.log
          retention-days: 90
      
      - name: ðŸ“ Generate Summary Report
        if: always()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          # ðŸ”’ Qualys Security Scan Report
          
          ## ðŸ“‹ Scan Information
          
          | Property | Value |
          |----------|-------|
          | ðŸ³ **Image** | `${{ inputs.image }}` |
          | ðŸ·ï¸ **Policy Tags** | `${{ inputs.policy_tags }}` |
          | ðŸ“… **Scan Date** | `$(date -u '+%Y-%m-%d %H:%M:%S UTC')` |
          | ðŸ‘¤ **Triggered By** | `${{ github.actor }}` |
          | ðŸ”¢ **Run Number** | `#${{ github.run_number }}` |
          | ðŸ“ **Pod** | `${{ secrets.QUALYS_POD }}` |
          
          ## ðŸ“Š Vulnerability Summary
          
          | Severity | Found | Threshold | Status |
          |----------|-------|-----------|--------|
          | ðŸ”´ **Critical** | ${{ steps.parse_results.outputs.critical }} | ${{ inputs.critical_threshold }} | ${{ steps.parse_results.outputs.critical <= inputs.critical_threshold && 'âœ… Pass' || 'âŒ Fail' }} |
          | ðŸŸ  **High** | ${{ steps.parse_results.outputs.high }} | ${{ inputs.high_threshold }} | ${{ steps.parse_results.outputs.high <= inputs.high_threshold && 'âœ… Pass' || 'âŒ Fail' }} |
          | ðŸŸ¡ **Medium** | ${{ steps.parse_results.outputs.medium }} | - | â„¹ï¸ Info |
          | ðŸŸ¢ **Low** | ${{ steps.parse_results.outputs.low }} | - | â„¹ï¸ Info |
          | **ðŸ“Š Total** | **${{ steps.parse_results.outputs.total }}** | - | - |
          
          ## ðŸŽ¯ Scan Result
          
          EOF
          
          if [ "${{ steps.threshold_check.outputs.passed }}" == "true" ]; then
            cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ### âœ… PASSED
          
          The image passed all security checks and is within acceptable vulnerability thresholds.
          EOF
          else
            cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ### âŒ FAILED
          
          The image failed security checks. Vulnerabilities exceed configured thresholds.
          
          **Action Required:** Review and remediate vulnerabilities before deployment.
          EOF
          fi
          
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          
          ## ðŸ“¦ Next Steps
          
          EOF
          
          if [ "${{ inputs.push_on_success }}" == "true" ] && [ "${{ steps.threshold_check.outputs.passed }}" == "true" ]; then
            echo "- âœ… Image will be pushed to registry: \`${{ inputs.target_registry }}\`" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ inputs.push_on_success }}" == "true" ]; then
            echo "- âš ï¸ Image will NOT be pushed (scan failed)" >> $GITHUB_STEP_SUMMARY
          else
            echo "- â„¹ï¸ Push to registry is disabled for this run" >> $GITHUB_STEP_SUMMARY
          fi
          
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          - ðŸ“„ [Download detailed report from artifacts](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
          
          ---
          
          *Report generated by Qualys Scanner ${{ env.QSCANNER_VERSION }}*
          EOF

  push-image:
    name: ðŸš€ Push Image to Registry
    needs: security-scan
    runs-on: ubuntu-latest
    if: |
      inputs.push_on_success == true && 
      needs.security-scan.outputs.scan_passed == 'true'
    
    permissions:
      contents: read
      packages: write
    
    steps:
      - name: ðŸ“‹ Push Information
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘         Pushing Image to Registry                    â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ðŸ³ Source image: ${{ inputs.image }}"
          echo "ðŸ“¦ Target registry: ${{ inputs.target_registry }}"
          echo "ðŸ“ Target repository: ${{ inputs.target_repository || 'same as source' }}"
          echo ""
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: ðŸ“¥ Pull scanned image
        run: |
          echo "Pulling verified image..."
          docker pull ${{ inputs.image }}
      
      - name: ðŸ” Log in to Docker Hub
        if: inputs.target_registry == 'docker.io' || inputs.target_registry == 'both'
        uses: docker/login-action@v3
        with:
          registry: docker.io
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: ðŸ” Log in to GitHub Container Registry
        if: inputs.target_registry == 'ghcr.io' || inputs.target_registry == 'both'
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ðŸ·ï¸ Tag and Push Image
        run: |
          SOURCE_IMAGE="${{ inputs.image }}"
          TARGET_REPO="${{ inputs.target_repository }}"
          
          # Use source image name if target repo not specified
          if [ -z "${TARGET_REPO}" ]; then
            TARGET_REPO=$(echo ${SOURCE_IMAGE} | cut -d':' -f1)
          fi
          
          TAG=$(echo ${SOURCE_IMAGE} | cut -d':' -f2)
          TIMESTAMP=$(date +%Y%m%d-%H%M%S)
          
          echo "Tagging and pushing images..."
          echo ""
          
          if [ "${{ inputs.target_registry }}" == "docker.io" ] || [ "${{ inputs.target_registry }}" == "both" ]; then
            TARGET_IMAGE="docker.io/${TARGET_REPO}:${TAG}"
            TIMESTAMPED_IMAGE="docker.io/${TARGET_REPO}:${TAG}-${TIMESTAMP}"
            
            echo "ðŸ“¦ Pushing to Docker Hub:"
            echo "  - ${TARGET_IMAGE}"
            echo "  - ${TIMESTAMPED_IMAGE}"
            
            docker tag ${SOURCE_IMAGE} ${TARGET_IMAGE}
            docker tag ${SOURCE_IMAGE} ${TIMESTAMPED_IMAGE}
            docker push ${TARGET_IMAGE}
            docker push ${TIMESTAMPED_IMAGE}
            
            echo "âœ… Pushed to Docker Hub"
          fi
          
          if [ "${{ inputs.target_registry }}" == "ghcr.io" ] || [ "${{ inputs.target_registry }}" == "both" ]; then
            TARGET_IMAGE="ghcr.io/${{ github.repository_owner }}/${TARGET_REPO}:${TAG}"
            TIMESTAMPED_IMAGE="ghcr.io/${{ github.repository_owner }}/${TARGET_REPO}:${TAG}-${TIMESTAMP}"
            
            echo "ðŸ“¦ Pushing to GitHub Container Registry:"
            echo "  - ${TARGET_IMAGE}"
            echo "  - ${TIMESTAMPED_IMAGE}"
            
            docker tag ${SOURCE_IMAGE} ${TARGET_IMAGE}
            docker tag ${SOURCE_IMAGE} ${TIMESTAMPED_IMAGE}
            docker push ${TARGET_IMAGE}
            docker push ${TIMESTAMPED_IMAGE}
            
            echo "âœ… Pushed to GHCR"
          fi
          
          # Save pushed images to output
          echo "pushed_images<<EOF" >> $GITHUB_ENV
          docker images --format "{{.Repository}}:{{.Tag}}" | grep -E "${TARGET_REPO}|ghcr.io" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV
      
      - name: ðŸ“ Push Summary
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          
          # ðŸš€ Image Push Summary
          
          ## âœ… Successfully Pushed Images
          
          EOF
          
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "${{ env.pushed_images }}" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          
          ## ðŸ“‹ Details
          
          | Property | Value |
          |----------|-------|
          | ðŸ³ Source Image | `${{ inputs.image }}` |
          | ðŸ“¦ Registry | `${{ inputs.target_registry }}` |
          | ðŸ”’ Security Status | âœ… Passed all checks |
          | ðŸ”´ Critical Vulns | ${{ needs.security-scan.outputs.critical_count }} |
          | ðŸŸ  High Vulns | ${{ needs.security-scan.outputs.high_count }} |
          | ðŸ“Š Total Vulns | ${{ needs.security-scan.outputs.total_count }} |
          
          ---
          
          *Images pushed at $(date -u '+%Y-%m-%d %H:%M:%S UTC')*
          EOF

  summary:
    name: ðŸ“Š Workflow Summary
    needs: [security-scan, push-image]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ðŸ“Š Final Summary
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘           Workflow Execution Complete                â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "Security Scan: ${{ needs.security-scan.result }}"
          echo "Image Push: ${{ needs.push-image.result }}"
          echo ""
          
          if [ "${{ needs.security-scan.result }}" == "success" ]; then
            echo "âœ… Security scan completed successfully"
          else
            echo "âŒ Security scan failed"
          fi
          
          if [ "${{ inputs.push_on_success }}" == "true" ]; then
            if [ "${{ needs.push-image.result }}" == "success" ]; then
              echo "âœ… Image pushed to registry"
            elif [ "${{ needs.push-image.result }}" == "skipped" ]; then
              echo "â­ï¸  Image push skipped (scan failed)"
            else
              echo "âŒ Image push failed"
            fi
          else
            echo "â„¹ï¸  Image push disabled for this run"
          fi
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Run Details: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
